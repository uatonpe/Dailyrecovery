<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>दैनंदिन रिकवरी रेकॉर्ड</title>
  <style>
    /* --- CSS Variables for Theming --- */
    :root {
      --brand-blue: #007AFF;
      --brand-green: #34C759;
      --brand-red: #FF3B30;
      --bg-color: #f0f2f5;
      --card-bg-color: #ffffff;
      --text-primary: #1c1c1e;
      --text-secondary: #636366;
      --border-color: #d1d1d6;
      --input-bg: #f7f7f7;
      --border-radius-m: 10px;
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
      --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* --- General Styles --- */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
    }

    body {
      font-family: var(--font-stack);
      background-color: var(--bg-color);
      margin: 0;
      padding: 1.5rem;
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* --- Header --- */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .main-header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      margin: 0 0 0.25rem 0;
    }
    .main-header p {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin: 0;
    }

    /* --- Card Layout --- */
    .card {
      background-color: var(--card-bg-color);
      border-radius: var(--border-radius-m);
      box-shadow: var(--shadow-light);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    .card-header {
      padding: 1rem 1.5rem;
      background-color: #f9fafb;
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      font-size: 1.15rem;
    }
    .card-body {
      padding: 1.5rem;
      display: grid;
      gap: 1.25rem;
    }

    /* --- Form Elements --- */
    .form-group {
      display: grid;
      grid-template-columns: 1fr 2fr; /* Adjusted for better layout */
      align-items: center;
      gap: 1rem;
    }
    
    /* Make Date and Staff Name fields look like the screenshot */
    .basic-info .form-group {
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    .basic-info .form-group:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .form-group label {
      font-weight: 500;
      color: var(--text-secondary);
    }
    input[type="text"], input[type="number"], input[type="date"], select {
      width: 100%;
      padding: 0.7rem 0.8rem;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 1rem;
      font-family: var(--font-stack);
      background-color: #fff;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
    }
    input:read-only {
      background-color: var(--input-bg);
      font-weight: 600;
      border-style: dashed;
    }
    
    /* --- Loan Details Table --- */
    #loan-details-section {
        border-top: 1px solid var(--border-color);
        padding-top: 1.5rem;
        margin-top: 1.5rem;
    }
    #loanTable {
        width: 100%;
        border-collapse: collapse;
    }
    #loanTable th, #loanTable td {
        padding: 0.5rem;
        text-align: left;
    }
    #loanTable th {
        color: var(--text-secondary);
        font-weight: 500;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.8rem;
    }
    #loanTable input { padding: 0.5rem; }
    .remove-loan-btn {
        background: none;
        border: none;
        color: var(--brand-red);
        cursor: pointer;
        font-weight: bold;
        font-size: 1.2rem;
    }
    .add-loan-btn {
        background-color: #e9ecef;
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border: 1px solid var(--border-color);
        cursor: pointer;
        font-size: 0.9rem;
        border-radius: 6px;
        transition: background-color 0.2s;
        float: right;
        margin-top: 10px;
    }
    .add-loan-btn:hover { background-color: #ced4da; }

    /* --- Action Buttons & Messages --- */
    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 6px;
      transition: background-color 0.2s, transform 0.1s;
      width: 100%;
      max-width: 300px;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background-color: var(--brand-blue); color: white; }
    .btn-primary:hover { background-color: #0056b3; }
    
    #status-message {
        text-align: center;
        margin-top: 1rem;
        font-weight: bold;
        padding: 0.8rem;
        border-radius: 6px;
    }
    .status-error { color: var(--brand-red); background-color: #ffebee; }

    /* ------------------------------------------- */
    /* ---         PRINT STYLES START          --- */
    /* ------------------------------------------- */
    
    #printSection { display: none; }

    @media print {
      body {
        background: #fff;
        margin: 0;
        padding: 0;
        font-family: 'Arial', sans-serif;
        font-size: 10pt;
        color: #000;
      }
      .container {
        max-width: 100%;
        width: 18cm;
        margin: auto;
        padding: 0;
        box-shadow: none;
      }
      #recoveryForm, .action-buttons, #status-message, .main-header {
        display: none !important;
      }
      #printSection {
        display: block !important;
      }
      .print-header {
        text-align: center;
        margin-bottom: 1.5cm;
      }
      .print-header h1 {
        font-size: 18pt;
        margin: 0;
        color: #000;
        font-weight: bold;
      }
      .print-header p {
        font-size: 11pt;
        margin-top: 5px;
        color: #444;
      }
      .print-fieldset {
        border: 1px solid #999;
        padding: 10px 15px 15px 15px;
        margin-bottom: 0.75cm;
      }
      .print-fieldset legend {
        font-weight: bold;
        font-size: 11pt;
        padding: 0 8px;
        color: #000;
      }
      .print-table {
        width: 100%;
        border-collapse: collapse;
      }
      .print-table td {
        padding: 6px 0;
        vertical-align: middle;
        font-size: 10pt;
      }
      .print-table td:first-child {
        width: 60%;
        padding-right: 15px;
      }
      .print-value {
        text-align: right;
        font-family: 'Consolas', 'Courier New', monospace;
      }
      .print-value.text {
        text-align: left;
        font-family: 'Arial', sans-serif;
      }
      .bold {
        font-weight: bold;
      }
      #print-loan-details-container {
          margin-top: 10px;
          margin-bottom: 10px;
      }
      #print-loan-details-container table {
          width: 100%;
          font-size: 9pt;
          border-collapse: collapse;
      }
      #print-loan-details-container th,
      #print-loan-details-container td {
          border: 1px solid #ccc;
          padding: 5px;
          text-align: left;
      }
      #print-loan-details-container th {
          background-color: #f2f2f2;
          font-weight: bold;
      }
      #print-loan-details-container td:nth-child(2) {
          text-align: right;
      }
      .no-offline-msg {
          text-align: center;
          font-style: italic;
          font-size: 9pt;
          color: #888;
          padding: 10px;
          border: 1px dashed #ccc;
      }
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="main-header">
      <h1>अनिक फायनान्सीयल सर्वीसेस</h1>
      <p>दैनंदिन रिकवरी रेकॉर्ड तपशील</p>
    </header>
    
    <form id="recoveryForm">
      <!-- Card 1: Basic Info (Updated as per your screenshot) -->
      <section class="card">
        <div class="card-body basic-info">
          <!-- Staff Name Text Input (No Dropdown) -->
          <div class="form-group">
            <label for="staffName">स्टाफचे नांव</label>
            <input type="text" id="staffName" placeholder="स्टाफचे संपूर्ण नाव लिहा" required>
          </div>
          <!-- Date Input -->
          <div class="form-group">
            <label for="reportDate">दिनांक</label>
            <input type="date" id="reportDate" required>
          </div>
        </div>
      </section>
      
      <div id="form-body">
        <!-- Card 2: Recovery Details -->
        <section class="card">
          <header class="card-header">एकूण वसुली तपशील</header>
          <div class="card-body">
            <div class="form-group">
              <label for="onlineRecovery">आजची एकूण ऑनलाइन रिकवरी (A)</label>
              <input type="number" id="onlineRecovery" placeholder="0.00" step="0.01" />
            </div>
            <div class="form-group">
              <label for="offlineRecoveryTotal">आजची एकूण ऑफलाईन रिकवरी (B)</label>
              <input type="number" id="offlineRecoveryTotal" readonly placeholder="0.00" />
            </div>
            
            <div id="loan-details-section">
                <table id="loanTable">
                    <thead><tr><th>कर्ज क्र.</th><th>रक्कम (₹)</th><th>कृती</th></tr></thead>
                    <tbody></tbody>
                </table>
                <button type="button" class="add-loan-btn" onclick="addLoanRow()">+ नवीन कर्ज जोडा</button>
            </div>

            <div class="form-group">
              <label for="totalRecovery">एकूण रिकवरी (C = A+B)</label>
              <input type="number" id="totalRecovery" readonly placeholder="0.00" />
            </div>
            <div class="form-group">
              <label for="openingAmount">प्रारंभीची शिल्लक (D)</label>
              <input type="number" id="openingAmount" placeholder="0.00" step="0.01" />
            </div>
            <div class="form-group">
              <label for="totalAmount">एकूण रक्कम (E = C+D)</label>
              <input type="number" id="totalAmount" readonly placeholder="0.00" />
            </div>
          </div>
        </section>
        
        <!-- Card 3: Cash Breakdown -->
        <section class="card">
          <header class="card-header">वरील रक्कमेची फोड</header>
          <div class="card-body">
            <div class="form-group"><label for="sbiAmount">स्टेट बॅंकेत भरणा (A)</label><input type="number" id="sbiAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="mgbAmount">महा ग्रामीणमध्ये भरणा (B)</label><input type="number" id="mgbAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="phonePayAmount">फोनपे QR (C)</label><input type="number" id="phonePayAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="otherBankAmount">AutoPay (D)</label><input type="number" id="otherBankAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="cashsr">वरीष्ठांकडे जमा (E)</label><input type="number" id="cashsr" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="officeAmount">ऑफिस मध्ये जमा (F)</label><input type="number" id="officeAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="cashInHandAmount">हातावर शिल्लक (G)</label><input type="number" id="cashInHandAmount" placeholder="0.00" step="0.01"/></div>
            <div class="form-group"><label for="totalBreakdown">एकूण फोड (A ते G)</label><input type="number" id="totalBreakdown" readonly placeholder="0.00" /></div>
            <div class="form-group"><label for="difference">तफावत (E - एकूण फोड)</label><input type="number" id="difference" readonly placeholder="0.00" /></div>
          </div>
        </section>
      </div>

      <div class="action-buttons">
        <button type="button" id="printBtn" class="btn btn-primary" onclick="prepareAndPrint()">रिपोर्ट प्रिंट करा</button>
      </div>
      <div id="status-message"></div>
    </form>

    <!-- ======================================================= -->
    <!-- !!         PRINT SECTION - HIDDEN ON SCREEN        !! -->
    <!-- ======================================================= -->
    <div id="printSection">
      <div class="print-header">
        <h1>अनिक फायनान्सीयल सर्वीसेस</h1>
        <p>दैनंदिन रिकवरी रेकॉर्ड तपशील</p>
      </div>

      <fieldset class="print-fieldset">
        <legend>General Details</legend>
        <table class="print-table">
          <tr><td>स्टाफचे नांव</td><td><div class="print-value text bold" id="print-staffName"></div></td></tr>
          <tr><td>दिनांक</td><td><div class="print-value text" id="print-date"></div></td></tr>
        </table>
      </fieldset>

      <fieldset class="print-fieldset">
        <legend>एकूण वसुली तपशील (Recovery Details)</legend>
        <table class="print-table">
          <tr><td>आजची एकूण ऑनलाइन रिकवरी (A)</td><td><div class="print-value" id="print-onlineRecovery"></div></td></tr>
          <tr><td>आजची एकूण ऑफलाईन रिकवरी (B)</td><td><div class="print-value" id="print-offlineRecoveryTotal"></div></td></tr>
        </table>
        
        <div id="print-loan-details-container"></div>
        
        <table class="print-table" style="margin-top: 10px;">
          <tr><td>एकूण रिकवरी (C = A+B)</td><td><div class="print-value bold" id="print-totalRecovery"></div></td></tr>
          <tr><td>प्रारंभीची शिल्लक रक्कम (D)</td><td><div class="print-value" id="print-openingAmount"></div></td></tr>
          <tr><td>एकूण रक्कम (E = C+D)</td><td><div class="print-value bold" id="print-totalAmount"></div></td></tr>
        </table>
      </fieldset>
      
      <fieldset class="print-fieldset">
        <legend>वरील रक्कमेची फोड (Cash Breakdown)</legend>
        <table class="print-table">
          <tr><td>स्टेट बँकेत भरणा (A)</td><td><div class="print-value" id="print-sbiAmount"></div></td></tr>
          <tr><td>महा ग्रामीणमध्ये भरणा (B)</td><td><div class="print-value" id="print-mgbAmount"></div></td></tr>
          <tr><td>फोनपे QR (C)</td><td><div class="print-value" id="print-phonePayAmount"></div></td></tr>
          <tr><td>ऑटो डेबिट (D)</td><td><div class="print-value" id="print-otherBankAmount"></div></td></tr>
          <tr><td>वरीष्ठांकडे जमा (E)</td><td><div class="print-value" id="print-cashsr"></div></td></tr>
          <tr><td>ऑफिस मध्ये जमा (F)</td><td><div class="print-value" id="print-officeAmount"></div></td></tr>
          <tr><td>हातावर शिल्लक (G)</td><td><div class="print-value" id="print-cashInHandAmount"></div></td></tr>
          <tr><td class="bold">एकूण फोड (A ते G)</td><td><div class="print-value bold" id="print-totalBreakdown"></div></td></tr>
          <tr><td class="bold">तफावत (E - एकूण फोड)</td><td><div class="print-value bold" id="print-difference"></div></td></tr>
        </table>
      </fieldset>
    </div>
  </main>
  
  <script>
    // --- Utility and Calculation Functions ---
    function getFloatValue(id) { return parseFloat(document.getElementById(id).value) || 0; }
    
    function addLoanRow() {
        const tbody = document.getElementById('loanTable').querySelector('tbody');
        const newRow = tbody.insertRow();
        newRow.innerHTML = `
            <td><input type="text" placeholder="कर्ज क्र."></td>
            <td><input type="number" step="0.01" placeholder="0.00"></td>
            <td><button type="button" class="remove-loan-btn" onclick="this.closest('tr').remove(); calculateAllTotals();">&times;</button></td>
        `;
    }
    
    function calculateAllTotals() {
        // 1. Calculate Offline Recovery from loan table
        const offlineRecovery = Array.from(document.querySelectorAll('#loanTable tbody input[type=number]'))
            .reduce((sum, el) => sum + (parseFloat(el.value) || 0), 0);
        document.getElementById('offlineRecoveryTotal').value = offlineRecovery.toFixed(2);
        
        // 2. Calculate Total Recovery and Total Amount
        const onlineRecovery = getFloatValue("onlineRecovery");
        const openingAmount = getFloatValue("openingAmount"); 
        const totalRecovery = onlineRecovery + offlineRecovery;
        const totalAmount = openingAmount + totalRecovery;
        document.getElementById('totalRecovery').value = totalRecovery.toFixed(2);
        document.getElementById('totalAmount').value = totalAmount.toFixed(2);

        // 3. Calculate Total Breakdown and Difference
        const breakdownIds = ['sbiAmount', 'mgbAmount', 'phonePayAmount', 'otherBankAmount', 'cashsr', 'officeAmount', 'cashInHandAmount'];
        const breakdownTotal = breakdownIds.reduce((sum, id) => sum + getFloatValue(id), 0);
        document.getElementById('totalBreakdown').value = breakdownTotal.toFixed(2);
        document.getElementById('difference').value = (totalAmount - breakdownTotal).toFixed(2);
    }

    // --- PRINT LOGIC ---
    function prepareAndPrint() {
        const statusDiv = document.getElementById('status-message');
        const staffName = document.getElementById('staffName').value;
        const reportDate = document.getElementById('reportDate').value;
        
        // Basic Validation
        if (!staffName.trim()) { alert("कृपया स्टाफचे नाव लिहा."); return; }
        if (!reportDate) { alert("कृपया दिनांक निवडा."); return; }
        
        const difference = getFloatValue("difference");
        if (Math.abs(difference) > 0.001) { 
            statusDiv.textContent = "तफावत (Difference) 0 नाही. कृपया रकमा तपासा.";
            statusDiv.className = 'status-error';
            alert("तफावत (Difference) 0 नाही. कृपया रकमा तपासा."); 
            return; 
        }
        
        statusDiv.textContent = "";
        statusDiv.className = "";

        // Gather Data
        const reportData = {
            reportDate: reportDate,
            staffName: staffName,
            openingAmount: getFloatValue('openingAmount'),
            onlineRecovery: getFloatValue('onlineRecovery'),
            offlineRecoveryTotal: getFloatValue('offlineRecoveryTotal'),
            totalRecovery: getFloatValue('totalRecovery'),
            totalAmount: getFloatValue('totalAmount'),
            sbiAmount: getFloatValue('sbiAmount'),
            mgbAmount: getFloatValue('mgbAmount'),
            phonePayAmount: getFloatValue('phonePayAmount'),
            otherBankAmount: getFloatValue('otherBankAmount'),
            cashsr: getFloatValue('cashsr'),
            officeAmount: getFloatValue('officeAmount'),
            cashInHandAmount: getFloatValue('cashInHandAmount')
        };

        // Populate and Print
        populatePrintSection(reportData);
        window.print();
    }

    function populatePrintSection(data) {
        const setVal = (id, value) => { document.getElementById(id).textContent = value; };
        const formatNum = (num) => (typeof num === 'number' ? num.toFixed(2) : '0.00');

        setVal('print-staffName', data.staffName);
        setVal('print-date', new Date(data.reportDate).toLocaleDateString('en-GB'));
        
        // Recovery Details
        setVal('print-onlineRecovery', formatNum(data.onlineRecovery));
        setVal('print-offlineRecoveryTotal', formatNum(data.offlineRecoveryTotal));
        setVal('print-totalRecovery', formatNum(data.totalRecovery));
        setVal('print-openingAmount', formatNum(data.openingAmount));
        setVal('print-totalAmount', formatNum(data.totalAmount));

        // Breakdown
        setVal('print-sbiAmount', formatNum(data.sbiAmount));
        setVal('print-mgbAmount', formatNum(data.mgbAmount));
        setVal('print-phonePayAmount', formatNum(data.phonePayAmount));
        setVal('print-otherBankAmount', formatNum(data.otherBankAmount));
        setVal('print-cashsr', formatNum(data.cashsr));
        setVal('print-officeAmount', formatNum(data.officeAmount));
        setVal('print-cashInHandAmount', formatNum(data.cashInHandAmount));

        const totalBreakdown = [data.sbiAmount, data.mgbAmount, data.phonePayAmount, data.otherBankAmount, data.cashsr, data.officeAmount, data.cashInHandAmount].reduce((a, b) => a + (b || 0), 0);
        setVal('print-totalBreakdown', formatNum(totalBreakdown));
        setVal('print-difference', formatNum(data.totalAmount - totalBreakdown));

        // Loan Details Table for Print
        const loanRows = document.querySelectorAll('#loanTable tbody tr');
        let loanTableHTML = '';
        let hasOfflineData = false;
        loanRows.forEach(row => {
            const loanNo = row.cells[0].querySelector('input').value;
            const amount = parseFloat(row.cells[1].querySelector('input').value || 0);
            if (loanNo.trim() || amount > 0) {
                if (!hasOfflineData) {
                    loanTableHTML += `<table><thead><tr><th>कर्ज क्रमांक</th><th>रक्कम (₹)</th></tr></thead><tbody>`;
                    hasOfflineData = true;
                }
                loanTableHTML += `<tr><td>${loanNo || '-'}</td><td>${formatNum(amount)}</td></tr>`;
            }
        });

        if(hasOfflineData) {
            loanTableHTML += '</tbody></table>';
        } else {
            loanTableHTML = '<div class="no-offline-msg">ऑफलाईन रिकवरी नाही.</div>';
        }
        document.getElementById('print-loan-details-container').innerHTML = loanTableHTML;
    }

    // --- Page Load Initializer ---
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
      addLoanRow();
      document.getElementById('recoveryForm').addEventListener('input', calculateAllTotals);
    });
  </script>
</body>
</html>
